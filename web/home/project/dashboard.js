!function(){function t(){var t=new ModalDialog({title:"新任务",content:'<form role="form" class="wrapAddTaskWorker">			<div class="form-group">				<input type="text" class="form-control" placeholder="任务标题">			</div>			<div class="form-group">				<textarea class="form-control" rows="5" placeholder="任务详情，选填"></textarea>			</div>			<div class="form-group">				<button type="button" class="btn btn-success J-btnAddWorker">+负责人</button>				<span class="J-wrapWorkerResult"></span>			</div>			<div class="checkbox warpMembers J-wrapSelectWorkers"></div>			<div class="form-group">				<button type="button" class="btn btn-success J-btnAddRelatedMember">+相关人员</button>				<span class="J-wrapRelatedMembersResult"></span>			</div>			<div class="checkbox warpMembers J-wrapSelectRelationWorkers"></div>		</form>',width:500,height:450,footer:'<button type="button" class="btn btn-primary">确定</button>'});t.on("click",".J-btnAddWorker",function(){var e=$(this),a=t.find(".J-wrapWorkerResult"),r=t.find(".J-wrapSelectWorkers");if("+负责人"==e.text()){var s=t.data("members");s||App.ajax({url:"/project/"+App.aParams.projectId+"/members.json",async:!1,success:function(e){t.data("members",e.data),s=e.data}});var n=function(){var t=[];return a.find(".J-worker").each(function(){t.push($(this).data("id"))}),t}(),o=[];for(var c in s){var i=-1!==$.inArray(s[c].id,n)?" checked":"";o.push('<label class="J-memberItem"><input class="J-member" type="checkbox" value="'+s[c].id+'"'+i+">"+s[c].name+"</label>")}r.html(o.join("")),e.text("确定")}else{var o=[];r.find(":checkbox").each(function(){this.checked&&o.push('<label class="J-worker" data-id="'+this.value+'">'+$(this).closest(".J-memberItem").text()+"</label>")}),a.html(o.join("、")),r.empty(),e.text("+负责人")}}),t.on("click",".J-btnAddRelatedMember",function(){var e=$(this),a=t.find(".J-wrapRelatedMembersResult"),r=t.find(".J-wrapSelectRelationWorkers");if("+相关人员"==e.text()){var s=t.data("members");s||App.ajax({url:"/project/"+App.aParams.projectId+"/members.json",async:!1,success:function(e){t.data("members",e.data),s=e.data}});var n=function(){var t=[];return a.find(".J-member").each(function(){t.push($(this).data("id"))}),t}(),o=[];for(var c in s){var i=-1!==$.inArray(s[c].id,n)?" checked":"";o.push('<label class="J-memberItem"><input class="J-member" type="checkbox" value="'+s[c].id+'"'+i+">"+s[c].name+"</label>")}r.html(o.join("")),e.text("确定")}else{var o=[];r.find(":checkbox").each(function(){this.checked&&o.push('<label class="J-member" data-id="'+this.value+'">'+$(this).closest(".J-memberItem").text()+"</label>")}),a.html(o.join("、")),r.empty(),e.text("+相关人员")}}),t.show()}function e(e){var a=this;a.id=e.id,a.name=e.name;var r=$('<div class="col-md-4 taskList J-taskList" data-id="'+a.id+'">\n		<h4 class="J-taskCategoryName">\n			'+a.name+'			<button type="button" class="btn btn-primary J-btnAddTask">+任务</button>		</h4>	</div>');return r.find(".J-taskCategoryName").hover(function(){$(this).find(".J-btnAddTask").show()},function(){$(this).find(".J-btnAddTask").hide()}),r.on("click",".J-btnAddTask",t),$.extend(a,r)}function a(){}function r(){var t=$("#wrapProjectHead"),e=t.find(".J-btnAddMember");t.hover(function(){e.show()},function(){e.hide()}),e.click(function(){var t=prompt("请输入他的UID，小x会发个加入邀请给他");if(t)return FormatValidator.isInteger(t)?void App.ajax({url:"/project/invite-member.do",data:{projectId:App.aParams.projectId,inviteWorkerId:t.trim()},success:function(t){App.alert(t.message)}}):void App.alert("UID是一个数字 (⊙ｏ⊙) 麻烦叫他进个人信息里看看")})}function s(){App.ajax({url:"/project/"+App.aParams.projectId+"/task-categorys.json",success:function(t){var a=$("#taskCategorys");for(var r in t.data){var s=new e(t.data[r]);a.append(s),o[s.id]=s}}})}function n(){App.ajax({url:"/project/"+App.aParams.projectId+".json",success:function(t){$("#projectName").text(t.data.name)}})}e.prototype.taskList=function(){var t=this;return{addTask:function(e){t.append(e)}}},e.prototype.showTasks=function(){var t=this;App.ajax({url:"/project/"+App.aParams.projectId+"/tasks.json",success:function(e){for(var r in e.data){var s=new a(e.data[r]);console.log(t.taskList),t.taskList.addTask(s)}}})};var o={};$(function(){App.loadParam("project/<projectId:\\d+>.htm"),r(),n(),s()})}();